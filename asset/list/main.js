define("list",["require"],function(e){function i(e){n.on("click","a.add-favor",function(t){var n={ids:$(this).attr("data-id")};return ajax.post(e,n,function(){},function(e){}),!1})}function s(){r.hover(function(){$(this).addClass("hover"),t.trigger("mouseover",{main:this,index:$(this).attr("data-index"),id:$(this).attr("data-id")})},function(){$(this).removeClass("hover"),t.trigger("mouseout",{main:this,index:$(this).attr("data-index"),id:$(this).attr("data-id")})})}var t=$({}),n=$("#house-lst"),r=n.children("li").not(".list-no-data");t.init=function(e){s(),i(e.favorUrl)};var o={};return t.getPoints=function(){return $.map(r,function(e,t){var n=$(e),r=n.attr("data-id");return o[r]=$(e),{id:r,index:t,rank:t+1,name:n.find(".where").text(),point:n.attr("data-geo").split(",")}})},t.highlight=function(e){if(!o[e])return;o[e].addClass("hover")},t.unhighlight=function(e){if(!o[e])return;o[e].removeClass("hover")},t}),define("map",["require"],function(e){function s(e){var t=document.createElement("script");t.src="http://api.map.baidu.com/api?v=1.5&ak="+e+"&callback=mapInitialize",document.body.appendChild(t)}var t=$({}),n,r=[],i={};t.add=function(e){var s=e.point;if(!s||s.length!=2||!s[1]||!s[0])return!1;var o=new BMap.Point(s[1],s[0]),u=new t.MapOverlay(o,e);n.addOverlay(u),r.push(o),i[e.id]=u},t.render=function(e){$.each(e,function(e,n){t.add(n)});if(!e.length||!r.length){n.centerAndZoom(o.cityName),n.zoomIn();return}n.setViewport(r,{delay:500})},window.mapInitialize=function(){function e(e){}n=new BMap.Map(o.domId),n.setCurrentCity(o.cityName),n.centerAndZoom(),n.addControl(new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL})),n.addEventListener("click",e),t.MapOverlay=function(e,t){this._point=e,this._data=t},t.MapOverlay.prototype=new BMap.Overlay,t.MapOverlay.prototype.initialize=function(e){this._map=e;var r=this._div=document.createElement("div");r.className="map-item",r.style.position="absolute",r.style.zIndex=BMap.Overlay.getZIndex(this._point.lat);var i=this._rankDiv=document.createElement("div");i.className="map-item-rank",$(i).text(this._data.rank);var s=this._nameDiv=document.createElement("div");$(s).addClass("map-item-name").text(this._data.name),r.appendChild(i),r.appendChild(s);var u=this,a=this._arrow=document.createElement("div");return a.style.background="url("+o.feRoot+"/asset/img/map-marker-arrow.png) no-repeat",a.style.position="absolute",a.style.width="14px",a.style.height="12px",a.style.top="34px",a.style.left="10px",a.style.overflow="hidden",r.appendChild(a),r.onmouseover=function(){u.onmouseover(),t.trigger("mouseover",u._data)},r.onmouseout=function(){u.onmouseout(),t.trigger("mouseout",u._data)},n.getPanes().labelPane.appendChild(r),r},t.MapOverlay.prototype.onmouseover=function(){var e=this;e._div.style.zIndex=0,$(e._rankDiv).addClass("map-item-rank-hover"),$(e._nameDiv).addClass("map-item-name-hover")},t.MapOverlay.prototype.onmouseout=function(){var e=this;e._div.style.zIndex=BMap.Overlay.getZIndex(e._point.lat),$(e._rankDiv).removeClass("map-item-rank-hover"),$(e._nameDiv).removeClass("map-item-name-hover")},t.MapOverlay.prototype.draw=function(){var e=this._map,t=e.pointToOverlayPixel(this._point);this._div.style.left=t.x-parseInt(this._arrow.style.left)+"px",this._div.style.top=t.y-30+"px"},t.trigger("ready",t)};var o;return t.init=function(e){o=$.extend({},e),s(e.ak)},t.highlight=function(e){if(!i[e])return;i[e].onmouseover()},t.unhighlight=function(e){if(!i[e])return;i[e].onmouseout()},t}),define("recommend",["require"],function(e){var t=$("#rec-dom"),n={},r='<div class="item"><div class="pic"><a href="#{url}"><img class="lazyload loaded" src="#{imgSrc}" alt="#{title}" /></a></div><div class="txt"><a href="{$item.url|escape:html}">#{title}</a> / #{averagePrice}元/㎡</div>#{houseCount}套在售  #{viewCount}人浏览</div>';return n.render=function(e){t.find(".recommend-lst").html($.map(e,function(e){return $.stringFormat(r,e)}).join("")),t.show()},n.start=function(e){var t=e.url;ajax.get(t,{},function(e){e.result instanceof Array&&e.result.length>0&&n.render(e.result)},function(e){})},n}),define("filter",["require"],function(e){function u(){var e=[],t=s.find("a:gt(0)").filter(".on"),e=$.map(t,function(e){var t=$(e).attr("data-index");return $(s.get(t)).find("dd a:first").attr("href")}),n=$.map(t,function(t,n){return $.stringFormat(o,$.encodeHTML(t.innerHTML),e[n])}),i=s.find(":text").filter(function(e){return $.trim($(this).val())>0});if(i.size()){var u=i.get(0).value+"-"+i.get(1).value+"万",a=$(i.get(0)).closest("dd").find("a:first").attr("href");n.push($.stringFormat(o,u,a))}$(n.join("")).insertBefore(r),t.size()&&r.show()}function a(){var e=i.find(".custom"),t=e.find(":text"),n=/x\d+y\d+/;e.find(".ok").on("click",function(){var e=1;t.each(function(t,n){var r=$(n),i=$.trim(r.val());i?r.parent().removeClass("txt-box-err"):(r.parent().addClass("txt-box-err"),e=0)});if(!e)return!1;var r=$.map(t,function(e){return $.trim($(e).val())}),i=f.baseUrl.replace(/p\d+/,"");n.test(i)?i=i.replace(/x\d+y\d+/,"x"+r[0]+"y"+r[1]).replace("n#placeHolder#",""):i=i.replace("n#placeHolder#","x"+r[0]+"y"+r[1]),window.location.href=i})}var t={},n=$("#filter-display-bar"),r=$("#filter-empty"),i=$("#filter-options"),s=i.find("dl"),o='<a href="#{1}"><span>#{0}</span><span class="del">&times;</span></a>',f;return t.init=function(e){f=$.extend({},e),u(),a()},t}),define("main",["require","./list","./map","./recommend","./filter"],function(e){function r(){s(),$("#filter-bar").fixtop({fixedWidth:"1098px"})}function s(){var e=50,t=i.parent().position().top,n=i.parent().height(),r=i.outerHeight(),s;$(window).on("scroll",function(){s&&clearTimeout(s);var o=$(document.body).scrollTop(),u=i.position().top,a=e+o-t;if(t+e<o){i.addClass("fixed");if(o+r+e>t+n){i.css({top:n-r+"px"});return}i.css({top:a+"px"})}else i.removeClass("fixed"),i.css({top:0})})}var t=e("./list"),n=e("./map"),i=$("#list-side");return{init:function(i){r(),e("./recommend").start({url:i.recommendUrl}),e("./filter").init({baseUrl:i.baseUrl}),t.init({favorUrl:i.favorUrl}),n.init({ak:i.mapak,domId:i.mapDomId,cityName:i.cityName,feRoot:i.feRoot});var s=t.getPoints();n.on("ready",function(){n.render(s),t.on("mouseover",function(e,t){n.highlight(t.id)}).on("mouseout",function(e,t){n.unhighlight(t.id)}),n.on("mouseover",function(e,n){t.highlight(n.id)}).on("mouseout",function(e,n){t.unhighlight(n.id)})})}}});