define("map",["require"],function(e){function c(e,t){t=t||function(){},BMap.Convertor.translate(e,2,t)}function p(){var e=r.find("a");e.on("click",function(){var t=$(this);if(t.hasClass("on"))return!1;var n=t.attr("data-key")||t.text();return e.removeClass("on"),t.addClass("on"),g(n,!0),!1})}function d(e,t,n){if(!l)return!1;t=t||function(){},a.setSearchCompleteCallback(function(e){if(a.getStatus()==BMAP_STATUS_SUCCESS){var n=[];for(var r=0;r<e.getCurrentNumPois();r++)n.push(e.getPoi(r));t(n)}else t([])}),n&&a.clearResults(),a.searchNearby(e,u,f)}function g(e,t){d(e,function(t){var n=$.map(t,function(e){var t=o.getDistance(e.point,u);return $.stringFormat(m,{title:e.title,desc:e.address,distance:t})});i.find("h3").text(e)},t)}function y(e){var t=document.createElement("script");t.src="http://api.map.baidu.com/api?v=1.5&ak="+e+"&callback=mapInitialize",document.body.appendChild(t)}var t=$({}),n,r=$("#map-indicator"),i=$("#env-list"),s,o,u,a,f=3e3,l;t.render=function(e,t){t=t||function(){},u=new BMap.Point(e[1],e[0]),c(u,function(e){u=e,o=new BMap.Map(n.domId),o.centerAndZoom(u,15),o.addControl(new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL})),o.addOverlay(new BMap.Marker(u)),a=new BMap.LocalSearch(o,{renderOptions:{map:o,panel:"map-result-list"}}),t()})},window.mapInitialize=function(){p(),t.render(n.point,function(){l=1,t.trigger("ready",t);var e=r.find("a.on").text();g(e)})};var h,v=i.find(".result-list"),m="<dl></dl>";return t.getLocalService=g,t.init=function(e){n=$.extend({},e),y(e.ak)},t}),define("album",["require"],function(e){function c(){p();if(u<=1)return!1;n.find(".pic-panel").hover(function(){$(this).addClass("pic-panel-hover")},function(){$(this).removeClass("pic-panel-hover")}),r.add(f).on("click",function(){var e=$(this);if(e.hasClass("disabled"))return!1;var t=e.attr("data-command"),n;return t=="prev"?n=l-1:t=="next"&&(n=l+1),h(n),!1}),o.on("click",function(){var e=$(this),t=+e.attr("data-index");return t!=l&&h(t),!1})}function h(e){var t=$(o.get(e));o.removeClass("on"),t.addClass("on"),$.showIframeImg?(a.children("iframe").remove(),$.showIframeImg(a,t.attr("data-large")),a.children("iframe").show()):a.find("img").attr("src",t.attr("data-large")),l=e,p(),d()}function p(){r.removeClass("disabled"),f.removeClass("disabled"),l<=0?(r.filter(":eq(0)").addClass("disabled"),f.filter(":eq(0)").addClass("disabled")):l>=u-1&&(r.filter(":eq(1)").addClass("disabled"),f.filter(":eq(1)").addClass("disabled"))}function d(){var e=$(o.get(l)),t=s.position().top,n=e.position().top+e.outerHeight()-i.height();n-=10,n>0?s.css({top:-n+"px"}):s.css({top:"14px"})}var t={},n=$("#album-box"),r=n.find("a.ctrl-btn"),i=n.find(".album-view-wrap"),s=i.children("ul"),o=s.find("li"),u=o.size(),a=n.find(".pic-panel-main"),f=n.find(".pic-panel-ctrl"),l=0;return t.init=c,t}),define("chart",["require"],function(e){function n(n,r){e(["echarts","echarts/chart/bar","echarts/chart/line"],function(e){var i=e.init(document.getElementById(n));i.setOption(r,!0),t.trigger("ready",i)})}function i(e){var t={type:"category",data:[]},n={0:[],1:[]};$.each(e,function(e,r){t.data[e]=r.time,n[0][e]=r["new"],n[1][e]=r.avePrice});var i=$.extend({},r);return i.xAxis=t,i.series[0].data=n[0],i.series[1].data=n[1],i}var t=$({});t.setOptions=function(e){},t.init=function(e,t){t.url&&ajax.get(t.url,{communityId:t.zoneId},function(t){n(e,i(t))},function(t){n(e,[])})},t.render=n;var r={tooltip:{trigger:"axis",formatter:function(e,t,n){var r=e[0][1];return r+="<br>"+e[0][0]+" : "+e[0][2]+" 套",r+="<br>"+e[1][0]+" : "+e[1][2]+" 元/㎡",r}},toolbox:{show:!1},calculable:!1,grid:{x:80,x2:10,y:30,y2:30},xAxis:[],yAxis:[{type:"value",name:"挂牌均价",boundaryGap:[0,.1]},{type:"value",name:"",boundaryGap:[0,.2],axisLabel:{formatter:" "}}],series:[{name:"挂牌套数",type:"bar",yAxisIndex:1,itemStyle:{normal:{color:"#e6e6e6",label:{show:!0,textStyle:{fontSize:"14",color:"#babdc1",fontFamily:"微软雅黑"},formatter:"{c} 套"}},emphasis:{color:"#babdc1"}},data:[]},{name:"挂牌均价",type:"line",symbol:"emptyCircle",symbolSize:5,itemStyle:{normal:{color:"#16449d",lineStyle:{width:3}}},data:[]}]};return t}),define("recommend",["require"],function(e){function i(e){r=$.extend({},e),$.each(n,function(e,t){s(t)})}function s(e){ajax.get(r.url[e],r.reqData,function(t){var n=t.result||t.list;if(n&&n instanceof Array){var r=u(e,n);a(e,r)}},function(e){})}function u(e,t){var n=$.map(t,function(n,r){r==t.length-1&&(n.itemStyle='class="last"'),n.orientation?n.orientation="&nbsp;"+n.orientation:n.orientation="";if(e=="region"){var i=n.region;if(i instanceof Array&&i[0]){var s=i[0];n.districtUrl=s.url||"#",n.districtTitle=s.title||""}}if(e=="newhouse"){var u=[];$.each(n.location,function(e,t){u[e]=$.stringFormat(o.newhouseRegion,t)}),n.regionHtml=u.join(" - ")}return $.stringFormat(o[e],n)});return n.join("")}function a(e,t){var n=$("#rec-"+e);t?(n.find("ul").html(t),n.show()):n.hide()}var t={},n=["similar","footstep","region","newhouse"],r,o={similar:'<li #{itemStyle}><a class="link-mask" target="_blank" href="#{url}"></a><a class="side-img" target="_blank" href="#{url}"><img src="#{imgSrc}"><span class="album-count fn-num"><b class="bg"></b><span><i class="ico-pic"></i><em>#{imgCount}</em></span></span></a><div class="price-box clear"><span class="price-text left"><em>#{price}</em>#{priceUnit}</span><span class="desc-text right desc-status-#{recStatus}">#{recText}</span></div><h4 class="sub-text"><a target="_blank" href="#{communityUrl}">#{communityName}</a></h4><p class="room-text">#{bedroom}室&nbsp;#{square}㎡#{orientation}</p></li>',footstep:'<li #{itemStyle}><a class="link-mask" target="_blank" href="#{url}"></a><a class="side-img" href="#{url}"><img src="#{imgSrc}"><b class="bg"></b><span class="album-count fn-num"><b class="bg"></b><span><i class="ico-pic"></i><em>#{imgCount}</em></span></span></a><div class="price-box clear"><span class="price-text left"><em>#{price}</em>#{priceUnit}</span><span class="desc-text right">#{bedroom}室&nbsp;#{square}㎡#{orientation}</span></div><p class="view-per"><em class="em-text">#{viewPercent}%</em>还看了：</p><h4 class="sub-text"><a target="_blank" href="#{communityUrl}">#{title}</a></h4></li>',region:'<li><a class="link-mask" target="_blank" href="#{url}"></a><a class="side-img" href="#{url}"><img src="#{imgSrc}"><b class="bg"></b><span class="album-count fn-num"><b class="bg"></b><span><i class="ico-pic"></i><em>#{imgCount}</em></span></span></a><div class="price-box clear"><span class="price-text left"><em>#{price}</em>#{priceUnit}</span><span class="desc-text right">#{bedroom}室&nbsp;#{square}㎡#{orientation}</span></div><h4 class="sub-text"><a href="#{districtUrl}">#{districtTitle}</a>&nbsp;-&nbsp;<a target="_blank" href="#{communityUrl}">#{communityName}</a></h4></li>',newhouse:'<li class="item"><a class="link-mask" target="_blank" href="#{url}"></a><div class="pic"><a target="_blank" href="#{url}"><img class="lazyload loaded" src="#{imgSrc}" alt="#{title}" /></a></div><div class="txt price-txt clear"><div class="left"><span class="price">#{price}</span>&nbsp;#{priceUnit}</div><div class="right">#{bedroom}室&nbsp;#{square}㎡#{orientation}</div></div><div class="loc">#{regionHtml}</div></li>',newhouseRegion:'<a target="_blank" href="#{url}">#{title}</a>'};return t.init=i,t}),define("main",["require","./map","./album","./chart","./recommend"],function(e){function f(){$("#btn-expand-album").on("click",function(){return s.show(),$(this).parent().hide(),!1});var e="bg-favor-bar-active";o.on("click",function(){var t=o.hasClass(e),n=a.url.follow;t&&(n=a.url.unfollow);var r=a.reqData;return ajax.post(n,r,function(){t?(o.removeClass(e),u.text("收藏此房")):(o.addClass(e),u.text("已收藏"))}),!1}).on("mouseover",function(){var t=o.hasClass(e);t&&u.text("取消收藏")}).on("mouseout",function(){var t=o.hasClass(e);t?u.text("已收藏"):u.text("收藏此房")}),n.fixtop({fixedWidth:"947px"}),n.on("click","a",function(){n.find("a").removeClass("on"),$(this).addClass("on")});var t;$(window).on("scroll",function(){t&&clearTimeout(t),t=setTimeout(function(){var e=$(window).scrollTop(),t;i.each(function(n,r){$(this).position().top<e+44&&(t=$(this))}),t||(t=i.filter(":first"));var r=n.find("a.on");if(r.attr("href")=="#"+t.attr("id"))return;r.removeClass("on"),n.find("a[href=#"+t.attr("id")+"]").addClass("on")},100)})}var t=e("./map"),n=$("#panel-tab"),r=n.next(".tab-content"),i=r.children("div"),s=$(".album-more"),o=$("#favor-bar"),u=o.children("em"),a;return{init:function(n){a=$.extend({},n),f(),e("./album").init();var r=n.priceData;e("./chart").init(n.chartDomId,{url:n.url.priceTrend,zoneId:n.zoneId}),t.init({ak:n.ak,domId:n.mapDomId,point:n.coordinates}),e("./recommend").init({url:n.url,reqData:n.reqData})}}});