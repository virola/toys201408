/*! betafang-fe 2014-08-20 */
define(function(){function a(){var a=$(window).height();j.height(a).children().height(a)}function b(a){$(document.body).append(c(a)),j=$(".m-tool"),k=j.find(".m-tool-main-box"),d()}function c(a){return $.stringFormat(n,{username:a.nickname,userAvator:a.userAvator||""})}function d(){a();var b;$(window).on("resize",function(){b&&clearTimeout(b),b=setTimeout(function(){a(),clearTimeout(b)},300)});var c;j.find(".m-tool-tab").hover(function(){$(this).addClass("m-tool-tab-hover");var a=$(this).find(".m-tool-tab-tip");c&&clearTimeout(c),c=setTimeout(function(){a.show().animate({right:50,opacity:1},500),clearTimeout(c)},200)},function(){$(this).removeClass("m-tool-tab-hover");var a=$(this).find(".m-tool-tab-tip");a.animate({right:80,opacity:0},500,function(){a.hide()})}).on("click",function(){var a=$(this).attr("data-command"),b=$(this).attr("data-box");"open"==a&&j.addClass("m-tool-open"),"top"==a&&$(document.body).animate({scrollTop:0}),b&&(k.hide(),k.filter(":eq("+b+")").show())}),j.find(".m-tool-bar-close").on("click",function(){j.removeClass("m-tool-open")}),j.find(".m-tool-main-box-list").on("mouseover","li",function(){$(this).addClass("hover")}).on("mouseout","li",function(){$(this).removeClass("hover")}).on("click",".close",function(){$(this).parent("li").remove()}),f(),g(),e()}function e(){j.find(".m-tool-main-box-ctrl").on("click","a",function(){return!1})}function f(){var a=j.find(".m-tool-main-box-search");a.find("input.txt").on("focusin",function(){$(this).parent().addClass("txt-wrap-focus")}).on("focusout",function(){$(this).parent().removeClass("txt-wrap-focus")}),a.find(".search-list").on("mouseover","li",function(){$(this).addClass("hover")}).on("mouseout","li",function(){$(this).removeClass("hover")})}function g(){var a={house:0,zone:0};j.find(".m-tool-main-box-favor .m-tool-main-box-tab").on("click","a",function(){var b=$(this),c=+b.attr("data-type");if(c!=v){if(1==c){if(a.zone)return!1;ajax.get(l.url.favor.zone,{},function(b){a.zone=0,1==v&&s.render(b,1)}),a.zone=1}else{if(a.house)return!1;ajax.get(l.url.favor.house,{},function(b){a.house=0,0==v&&s.render(b)}),a.house=1}v=c,b.siblings().removeClass("on"),b.addClass("on")}return!1})}function h(){$("<link>").attr("rel","stylesheet").attr("href",l.feRoot+"/asset/common/toolbar.css").appendTo($(document.head))}function i(){var a=l.url;ajax.get(a.msg,{},function(a){r.render(a)}),ajax.get(a.favor.house,{},function(a){s.render(a)}),ajax.get(a.history,{},function(a){t.render(a.list)}),ajax.get(a.search,{},function(a){u.render(a.result)})}var j,k,l,m={},n='<div class="m-tool"><div class="m-tool-mask"></div><div class="m-tool-bar"><div class="m-tool-close m-tool-bar-close"></div><div class="m-tool-task"><div class="m-tool-tab-user" title="#{username}"><img src="#{userAvator}"></div><div class="m-tool-tab" data-command="open" data-box="0"><div class="m-tool-tab-logo m-tool-tab-logo-msg"></div><div class="m-tool-tab-tip">我的消息<div class="m-tool-bar-arr m-tool-tab-tip-arr">◆</div></div></div><div class="m-tool-tab" data-command="open" data-box="1"><div class="m-tool-tab-logo m-tool-tab-logo-favor"></div><div class="m-tool-tab-tip">我的收藏<div class="m-tool-bar-arr m-tool-tab-tip-arr">◆</div></div></div><div class="m-tool-tab" data-command="open" data-box="2"><div class="m-tool-tab-logo m-tool-tab-logo-clock"></div><div class="m-tool-tab-tip">浏览历史<div class="m-tool-bar-arr m-tool-tab-tip-arr">◆</div></div></div><div class="m-tool-tab" data-command="open" data-box="3"><div class="m-tool-tab-logo m-tool-tab-logo-find"></div><div class="m-tool-tab-tip">快速找房<div class="m-tool-bar-arr m-tool-tab-tip-arr">◆</div></div></div><div class="m-tool-tab" data-command="top"><div class="m-tool-tab-logo m-tool-tab-logo-top"></div><div class="m-tool-tab-tip">返回顶部<div class="m-tool-bar-arr m-tool-tab-tip-arr">◆</div></div></div></div></div><div class="m-tool-main"><div class="m-tool-main-wrap"><div class="m-tool-main-box m-tool-main-box-msg"><h3 class="m-tool-main-box-title">动态提醒</h3><div class="m-tool-main-box-ctrl clear"><div class="left">共有<em class="m-tool-ctrl-count"></em>套房源</div><div class="right"><a href="#" data-command="clear">全部清除</a>&nbsp;&nbsp;<a href="#" data-command="refresh">刷新</a></div></div><div class="m-tool-main-box-list"><ul></ul></div></div><div class="m-tool-main-box m-tool-main-box-favor"><h3 class="m-tool-main-box-title">我的关注</h3><div class="m-tool-main-box-tab clear"><a href="#" class="on" data-type="0">关注的房源</a><a href="#" data-type="1">关注的小区</a></div><div class="m-tool-main-box-ctrl clear"><div class="left">共有<em class="m-tool-ctrl-count"></em>套房源</div><div class="right"><a href="#">刷新</a></div></div><div class="m-tool-main-box-list"><ul></ul></div></div><div class="m-tool-main-box m-tool-main-box-favor"><h3 class="m-tool-main-box-title">最近浏览历史</h3><div class="m-tool-main-box-list"><ul></ul></div></div><div class="m-tool-main-box m-tool-main-box-search"><h3 class="m-tool-main-box-title">找房条件</h3><div class="m-tool-main-box-list"><a class="search-add-btn" href="#">+ 添加找房条件</a><div class="content"><div class="m-tool-bar-arr m-tool-main-box-arr">◆</div><form onsubmit="return false"><div class="form-line clear"><div class="left">城区/商圈</div><div class="right"><div class="select"><div class="select-display"><span class="placeholder">请选择</span></div></div></div></div><div class="form-line clear"><div class="left">户型</div><div class="right"><div class="select"><div class="select-display"><span class="placeholder">请选择</span></div></div></div></div><div class="form-line clear"><div class="left">面积</div><div class="right"><div class="txt-wrap"><input class="txt"><span>㎡</span></div>&nbsp;-&nbsp;<div class="txt-wrap"><input class="txt"><span>㎡</span></div></div></div><div class="form-line clear"><div class="left">价格</div><div class="right"><div class="txt-wrap"><input class="txt"><span>万</span></div>&nbsp;-&nbsp;<div class="txt-wrap"><input class="txt"><span>万</span></div></div></div><div class="form-line form-btn clear"><div class="right"><button class="save-btn">保存</button><button class="cancel-btn">取消</button></div></div></form></div></div><ul class="search-list"></ul></div></div></div></div>',o={msg:'<li data-id="#{msgId}" data-link="#{url}" #{removeClass}><div class="title clear"><h4 class="left">#{title}</h4><span class="date right">#{date}</span></div><div class="content clear"><div class="m-tool-bar-arr m-tool-main-box-arr">◆</div><div class="content-img left"><a href="#{url}"><img src="#{imgSrc}"></a></div><div class="content-info right"><h5><a href="#{url}">#{detailTitle}</a></h5><p>#{region}</p><p>#{bedroom}室 #{square}㎡</p></div></div>#{extraHtml}<div class="close"><div class="m-tool-close"></div></div></li>',msgRemove:'<li data-id="#{msgId}" data-link="#{url}" #{removeClass}><div class="title clear"><h4 class="left">#{title}</h4><span class="date right">#{date}</span></div><div class="content clear"><div class="m-tool-bar-arr m-tool-main-box-arr">◆</div><div class="content-img left"><img src="#{imgSrc}"></div><div class="content-info right"><h5>#{detailTitle}</h5><p>#{region}</p><p>#{bedroom}室 #{square}㎡</p></div></div>#{extraHtml}<div class="close"><div class="m-tool-close"></div></div></li>',house:'<li class="content clear" data-id="#{houseId}" data-link="#{url}"><div class="content-img left"><a href="#{url}"><img src="#{imgSrc}"></a></div><div class="content-info right"><h5><a href="#{url}">#{title}</a></h5><p>#{region} - #{bedroom}室 #{square}㎡</p><div class="favor-text clear"><div class="favor-time left">#{favorTime}</div><div class="price right"><em class="ft-num">#{price}</em> #{priceUnit}</div></div></div><div class="close"><div class="m-tool-close"></div></div></li>',zone:'<li class="content clear" data-id="#{houseId}" data-link="#{url}"><div class="content-img left"><a href="#{url}"><img src="#{imgSrc}"></a></div><div class="content-info right"><h5><a href="#{url}">#{title}</a></h5><p>均价：#{averagePrice}元/平米</p><p>共#{houseCount}套房源在售</p><div class="favor-text"><div class="favor-time">#{favorTime}</div></div></div><div class="close"><div class="m-tool-close"></div></div></li>',history:'<li class="content clear" data-id="#{houseId}" data-link="#{url}"><div class="content-img left"><a href="#{url}"><img src="#{imgSrc}"></a></div><div class="content-info right"><h5><a href="#{url}">#{title}</a></h5><p>#{region} - #{bedroom}室 #{square}㎡</p><div class="favor-text clear"><div class="favor-time left">#{favorTime}</div><div class="price right"><em class="ft-num">#{price}</em> #{priceUnit}</div></div></div></li>',search:'<li><span class="m-tool-circle">●</span><a href="#{url}">#{title}</a><a class="search-delete" href="#">删除</a><p>#{count}套房源在售</p></li>',msgExtraHouse:'<div class="extra-info">与你关注的房源 <em>#{0}</em> 相似</div>'},p={msg:'<div class="msg-empty"><h4>呣~还没有新的动态呢...</h4><p>小贝仍在为您时刻关注最新的房源动态，稍后再来看看吧！</p></div>',msgNoFavor:'<div class="msg-empty"><h4>还没关注房源</h4><p>关注后，我会在这里告诉你它们最近的动态</p><ul class="empty-entry"><li><i class="ico-tick"></i>房子价格变化</li><li><i class="ico-tick"></i>房子下架情况</li><li><i class="ico-tick"></i>新上相似房源</li><li><i class="ico-tick"></i>小区新上房源</li></ul></div>',favor:'<div class="msg-empty"><h4>还没关注房源</h4><p>关注后，我会及时通知你它们最近的动态</p><ul class="empty-entry"><li><i class="ico-tick"></i>房子价格变化</li><li><i class="ico-tick"></i>房子下架情况</li><li><i class="ico-tick"></i>新上相似房源</li><li><i class="ico-tick"></i>小区新上房源</li></ul></div>',history:'<div class="msg-empty"><h4>还没有浏览历史哦...</h4><p>小贝仍在为您时刻关注最新的房源动态，稍后再来看看吧！</p></div>'},q={alert:1,recHouse:2,recCom:3,remove:4},r=function(){function a(a){return $.map(a,function(a){var b=o.msg;a.type==q.remove?(b=o.msgRemove,a.removeClass='class="remove"'):a.type==q.recHouse&&(a.extraHtml=$.stringFormat(o.msgExtraHouse,a.relatedKeyword));var c=$.extend({detailTitle:a.content.item.title},a.content.item,a);return $.stringFormat(b,c)}).join("")}function b(b){var c=k.filter(":eq(0)"),d=c.find(".m-tool-main-box-ctrl"),e=c.find(".m-tool-ctrl-count"),f=c.find(".m-tool-main-box-list>ul"),g=b.count||0;e.text(g);var h=a(b.list);g>0&&h?(f.html(h),d.show()):(f.parent().html(p.msg),d.hide())}return{render:b}}(),s=function(){function a(a){return $.map(a,function(a){var b=$.extend({},a);return $.stringFormat(o.house,b)}).join("")}function b(a){return $.map(a,function(a){var b=$.extend({},a);return $.stringFormat(o.zone,b)}).join("")}function c(c,d){var e=k.filter(":eq(1)"),f=e.find(".m-tool-ctrl-count"),g=e.find(".m-tool-main-box-list>ul"),h=e.find(".m-tool-main-box-ctrl"),i=c.count||0;f.text(i);var j;j=1==d?b(c.list):a(c.list),i>0&&j?(g.html(j),h.show()):h.hide()}return{render:c}}(),t=function(){function a(a){return $.map(a,function(a){var b=o.history,c=$.extend({},a);return $.stringFormat(b,c)}).join("")}function b(b){var c=k.filter(":eq(2)"),d=c.find(".m-tool-main-box-list>ul"),e=a(b);e?d.html(e):d.parent().html(p.history)}return{render:b}}(),u=function(){function a(a){return $.map(a,function(a){var b=o.search,c=$.extend({},a);return $.stringFormat(b,c)}).join("")}function b(b){var c=k.filter(":eq(3)"),d=c.find(".search-list"),e=a(b);d.html(e||"")}return{render:b}}(),v=0;return m.init=function(a){l=$.extend({},a);var c=a.url;ajax.get(c.user,{},function(a){a&&a.userAvator&&(h(),b(a),i())})},m});